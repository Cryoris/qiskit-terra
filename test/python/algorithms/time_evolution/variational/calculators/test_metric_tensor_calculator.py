# This code is part of Qiskit.
#
# (C) Copyright IBM 2021, 2022.
#
# This code is licensed under the Apache License, Version 2.0. You may
# obtain a copy of this license in the LICENSE.txt file in the root directory
# of this source tree or at http://www.apache.org/licenses/LICENSE-2.0.
#
# Any modifications or derivative works of this code must retain this
# copyright notice, and modified files need to carry a notice indicating
# that they have been altered from the originals.

"""Test metric tensor calculator."""

import unittest
from test.python.algorithms import QiskitAlgorithmsTestCase
import numpy as np
from numpy import array

from qiskit.algorithms.evolvers.variational.calculators.metric_tensor_calculator import (
    calculate,
)
from qiskit.circuit.library import EfficientSU2
from qiskit.opflow import SummedOp, X, Y, I, Z


class TestMetricTensorCalculator(QiskitAlgorithmsTestCase):
    """Test metric tensor calculator."""

    # checked, correct
    def test_calculate_real(self):
        """Test calculating the real part of a metric tensor."""
        observable = SummedOp(
            [
                0.2252 * (I ^ I),
                0.5716 * (Z ^ Z),
                0.3435 * (I ^ Z),
                -0.4347 * (Z ^ I),
                0.091 * (Y ^ Y),
                0.091 * (X ^ X),
            ]
        ).reduce()

        d = 2
        ansatz = EfficientSU2(observable.num_qubits, reps=d)

        # Define a set of initial parameters
        parameters = ansatz.ordered_parameters
        metric_tensor = calculate(ansatz, parameters)

        values_dict = [
            {param: np.pi / 4 for param in parameters},
            {param: np.pi / 2 for param in parameters},
        ]
        # TODO extract
        correct_values = [
            array(
                [
                    [
                        1.00000000e00 + 0.0j,
                        0.00000000e00 + 0.0j,
                        8.30000000e-17 + 0.0j,
                        5.60000000e-17 + 0.0j,
                        3.53553391e-01 + 0.0j,
                        8.30000000e-17 + 0.0j,
                        2.50000000e-01 + 0.0j,
                        5.60000000e-17 + 0.0j,
                        -5.66941738e-01 + 0.0j,
                        1.25000000e-01 + 0.0j,
                        4.00888348e-01 + 0.0j,
                        -1.25000000e-01 + 0.0j,
                    ],
                    [
                        0.00000000e00 + 0.0j,
                        1.00000000e00 + 0.0j,
                        0.00000000e00 + 0.0j,
                        -2.80000000e-17 + 0.0j,
                        -3.53553391e-01 + 0.0j,
                        5.00000000e-01 + 0.0j,
                        2.50000000e-01 + 0.0j,
                        5.00000000e-01 + 0.0j,
                        -3.38388348e-01 + 0.0j,
                        3.01776695e-01 + 0.0j,
                        5.92830086e-01 + 0.0j,
                        8.01776695e-01 + 0.0j,
                    ],
                    [
                        8.30000000e-17 + 0.0j,
                        0.00000000e00 + 0.0j,
                        5.00000000e-01 + 0.0j,
                        -5.55111512e-17 + 0.0j,
                        -1.76776695e-01 + 0.0j,
                        2.50000000e-01 + 0.0j,
                        4.78553391e-01 + 0.0j,
                        2.50000000e-01 + 0.0j,
                        -2.05805826e-01 + 0.0j,
                        2.75888348e-01 + 0.0j,
                        4.19733047e-02 + 0.0j,
                        -2.75888348e-01 + 0.0j,
                    ],
                    [
                        5.60000000e-17 + 0.0j,
                        -2.80000000e-17 + 0.0j,
                        -5.55111512e-17 + 0.0j,
                        5.00000000e-01 + 0.0j,
                        -1.76776695e-01 + 0.0j,
                        -2.50000000e-01 + 0.0j,
                        1.25000000e-01 + 0.0j,
                        5.00000000e-01 + 0.0j,
                        2.05805826e-01 + 0.0j,
                        -2.75888348e-01 + 0.0j,
                        3.12500000e-02 + 0.0j,
                        7.76650429e-02 + 0.0j,
                    ],
                    [
                        3.53553391e-01 + 0.0j,
                        -3.53553391e-01 + 0.0j,
                        -1.76776695e-01 + 0.0j,
                        -1.76776695e-01 + 0.0j,
                        9.37500000e-01 + 0.0j,
                        -4.41941738e-01 + 0.0j,
                        -8.08058262e-02 + 0.0j,
                        -1.76776695e-01 + 0.0j,
                        5.98191738e-02 + 0.0j,
                        -8.99587393e-02 + 0.0j,
                        -5.68689110e-03 + 0.0j,
                        -4.95288825e-01 + 0.0j,
                    ],
                    [
                        8.30000000e-17 + 0.0j,
                        5.00000000e-01 + 0.0j,
                        2.50000000e-01 + 0.0j,
                        -2.50000000e-01 + 0.0j,
                        -4.41941738e-01 + 0.0j,
                        8.75000000e-01 + 0.0j,
                        -1.07233047e-02 + 0.0j,
                        -3.95979797e-17 + 0.0j,
                        -6.28791261e-01 + 0.0j,
                        1.01332521e-01 + 0.0j,
                        3.92924785e-02 + 0.0j,
                        4.24555826e-01 + 0.0j,
                    ],
                    [
                        2.50000000e-01 + 0.0j,
                        2.50000000e-01 + 0.0j,
                        4.78553391e-01 + 0.0j,
                        1.25000000e-01 + 0.0j,
                        -8.08058262e-02 + 0.0j,
                        -1.07233047e-02 + 0.0j,
                        8.95526695e-01 + 0.0j,
                        5.51776695e-01 + 0.0j,
                        -1.51213586e-01 + 0.0j,
                        6.33692956e-01 + 0.0j,
                        5.38142586e-01 + 0.0j,
                        -2.19860435e-01 + 0.0j,
                    ],
                    [
                        5.60000000e-17 + 0.0j,
                        5.00000000e-01 + 0.0j,
                        2.50000000e-01 + 0.0j,
                        5.00000000e-01 + 0.0j,
                        -1.76776695e-01 + 0.0j,
                        -3.95979797e-17 + 0.0j,
                        5.51776695e-01 + 0.0j,
                        1.00000000e00 + 0.0j,
                        -5.23969696e-17 + 0.0j,
                        7.06984848e-17 + 0.0j,
                        3.90165043e-01 + 0.0j,
                        2.28553391e-01 + 0.0j,
                    ],
                    [
                        -5.66941738e-01 + 0.0j,
                        -3.38388348e-01 + 0.0j,
                        -2.05805826e-01 + 0.0j,
                        2.05805826e-01 + 0.0j,
                        5.98191738e-02 + 0.0j,
                        -6.28791261e-01 + 0.0j,
                        -1.51213586e-01 + 0.0j,
                        -5.23969696e-17 + 0.0j,
                        7.81135011e-01 + 0.0j,
                        -1.53176576e-01 + 0.0j,
                        -2.44557038e-01 + 0.0j,
                        -1.80635315e-01 + 0.0j,
                    ],
                    [
                        1.25000000e-01 + 0.0j,
                        3.01776695e-01 + 0.0j,
                        2.75888348e-01 + 0.0j,
                        -2.75888348e-01 + 0.0j,
                        -8.99587393e-02 + 0.0j,
                        1.01332521e-01 + 0.0j,
                        6.33692956e-01 + 0.0j,
                        7.06984848e-17 + 0.0j,
                        -1.53176576e-01 + 0.0j,
                        8.70518804e-01 + 0.0j,
                        5.29727238e-01 + 0.0j,
                        -7.67845869e-02 + 0.0j,
                    ],
                    [
                        4.00888348e-01 + 0.0j,
                        5.92830086e-01 + 0.0j,
                        4.19733047e-02 + 0.0j,
                        3.12500000e-02 + 0.0j,
                        -5.68689110e-03 + 0.0j,
                        3.92924785e-02 + 0.0j,
                        5.38142586e-01 + 0.0j,
                        3.90165043e-01 + 0.0j,
                        -2.44557038e-01 + 0.0j,
                        5.29727238e-01 + 0.0j,
                        7.26734984e-01 + 0.0j,
                        2.91560978e-01 + 0.0j,
                    ],
                    [
                        -1.25000000e-01 + 0.0j,
                        8.01776695e-01 + 0.0j,
                        -2.75888348e-01 + 0.0j,
                        7.76650429e-02 + 0.0j,
                        -4.95288825e-01 + 0.0j,
                        4.24555826e-01 + 0.0j,
                        -2.19860435e-01 + 0.0j,
                        2.28553391e-01 + 0.0j,
                        -1.80635315e-01 + 0.0j,
                        -7.67845869e-02 + 0.0j,
                        2.91560978e-01 + 0.0j,
                        9.54465413e-01 + 0.0j,
                    ],
                ]
            ),
            array(
                [
                    [
                        1.00000000e00 + 0.0j,
                        0.00000000e00 + 0.0j,
                        1.67000000e-16 + 0.0j,
                        0.00000000e00 + 0.0j,
                        0.00000000e00 + 0.0j,
                        5.60000000e-17 + 0.0j,
                        1.67000000e-16 + 0.0j,
                        -5.60000000e-17 + 0.0j,
                        0.00000000e00 + 0.0j,
                        3.33000000e-16 + 0.0j,
                        -1.67000000e-16 + 0.0j,
                        -2.80000000e-17 + 0.0j,
                    ],
                    [
                        0.00000000e00 + 0.0j,
                        1.00000000e00 + 0.0j,
                        0.00000000e00 + 0.0j,
                        2.50000000e-16 + 0.0j,
                        -1.00000000e00 + 0.0j,
                        -5.60000000e-17 + 0.0j,
                        8.30000000e-17 + 0.0j,
                        1.00000000e00 + 0.0j,
                        -5.60000000e-17 + 0.0j,
                        4.20000000e-17 + 0.0j,
                        -2.80000000e-17 + 0.0j,
                        2.80000000e-17 + 0.0j,
                    ],
                    [
                        1.67000000e-16 + 0.0j,
                        0.00000000e00 + 0.0j,
                        1.00000000e00 + 0.0j,
                        -1.24320000e-32 + 0.0j,
                        2.80000000e-17 + 0.0j,
                        1.00000000e00 + 0.0j,
                        8.30000000e-17 + 0.0j,
                        2.80000000e-17 + 0.0j,
                        2.80000000e-17 + 0.0j,
                        -3.05000000e-16 + 0.0j,
                        1.11000000e-16 + 0.0j,
                        1.00000000e00 + 0.0j,
                    ],
                    [
                        0.00000000e00 + 0.0j,
                        2.50000000e-16 + 0.0j,
                        -1.24320000e-32 + 0.0j,
                        1.00000000e00 + 0.0j,
                        1.11000000e-16 + 0.0j,
                        1.67000000e-16 + 0.0j,
                        2.50000000e-16 + 0.0j,
                        2.78000000e-16 + 0.0j,
                        4.20000000e-17 + 0.0j,
                        -1.67000000e-16 + 0.0j,
                        1.53000000e-16 + 0.0j,
                        -8.30000000e-17 + 0.0j,
                    ],
                    [
                        0.00000000e00 + 0.0j,
                        -1.00000000e00 + 0.0j,
                        2.80000000e-17 + 0.0j,
                        1.11000000e-16 + 0.0j,
                        1.00000000e00 + 0.0j,
                        1.11000000e-16 + 0.0j,
                        -1.94000000e-16 + 0.0j,
                        -1.00000000e00 + 0.0j,
                        5.60000000e-17 + 0.0j,
                        -5.60000000e-17 + 0.0j,
                        -1.11000000e-16 + 0.0j,
                        1.11000000e-16 + 0.0j,
                    ],
                    [
                        5.60000000e-17 + 0.0j,
                        -5.60000000e-17 + 0.0j,
                        1.00000000e00 + 0.0j,
                        1.67000000e-16 + 0.0j,
                        1.11000000e-16 + 0.0j,
                        1.00000000e00 + 0.0j,
                        -4.20000000e-17 + 0.0j,
                        2.40840000e-32 + 0.0j,
                        -1.00000000e-18 + 0.0j,
                        -1.94000000e-16 + 0.0j,
                        5.60000000e-17 + 0.0j,
                        1.00000000e00 + 0.0j,
                    ],
                    [
                        1.67000000e-16 + 0.0j,
                        8.30000000e-17 + 0.0j,
                        8.30000000e-17 + 0.0j,
                        2.50000000e-16 + 0.0j,
                        -1.94000000e-16 + 0.0j,
                        -4.20000000e-17 + 0.0j,
                        1.00000000e00 + 0.0j,
                        1.94000000e-16 + 0.0j,
                        -5.60000000e-17 + 0.0j,
                        1.25000000e-16 + 0.0j,
                        2.08000000e-16 + 0.0j,
                        -5.60000000e-17 + 0.0j,
                    ],
                    [
                        -5.60000000e-17 + 0.0j,
                        1.00000000e00 + 0.0j,
                        2.80000000e-17 + 0.0j,
                        2.78000000e-16 + 0.0j,
                        -1.00000000e00 + 0.0j,
                        2.40840000e-32 + 0.0j,
                        1.94000000e-16 + 0.0j,
                        1.00000000e00 + 0.0j,
                        -9.60000000e-17 + 0.0j,
                        8.30000000e-17 + 0.0j,
                        1.39000000e-16 + 0.0j,
                        1.11000000e-16 + 0.0j,
                    ],
                    [
                        0.00000000e00 + 0.0j,
                        -5.60000000e-17 + 0.0j,
                        2.80000000e-17 + 0.0j,
                        4.20000000e-17 + 0.0j,
                        5.60000000e-17 + 0.0j,
                        -1.00000000e-18 + 0.0j,
                        -5.60000000e-17 + 0.0j,
                        -9.60000000e-17 + 0.0j,
                        1.11022302e-16 + 0.0j,
                        -5.55111512e-16 + 0.0j,
                        1.10000000e-16 + 0.0j,
                        -1.61000000e-16 + 0.0j,
                    ],
                    [
                        3.33000000e-16 + 0.0j,
                        4.20000000e-17 + 0.0j,
                        -3.05000000e-16 + 0.0j,
                        -1.67000000e-16 + 0.0j,
                        -5.60000000e-17 + 0.0j,
                        -1.94000000e-16 + 0.0j,
                        1.25000000e-16 + 0.0j,
                        8.30000000e-17 + 0.0j,
                        -5.55111512e-16 + 0.0j,
                        4.44089210e-16 + 0.0j,
                        -1.10000000e-16 + 0.0j,
                        -1.03000000e-16 + 0.0j,
                    ],
                    [
                        -1.67000000e-16 + 0.0j,
                        -2.80000000e-17 + 0.0j,
                        1.11000000e-16 + 0.0j,
                        1.53000000e-16 + 0.0j,
                        -1.11000000e-16 + 0.0j,
                        5.60000000e-17 + 0.0j,
                        2.08000000e-16 + 0.0j,
                        1.39000000e-16 + 0.0j,
                        1.10000000e-16 + 0.0j,
                        -1.10000000e-16 + 0.0j,
                        1.00000000e00 + 0.0j,
                        1.80000000e-16 + 0.0j,
                    ],
                    [
                        -2.80000000e-17 + 0.0j,
                        2.80000000e-17 + 0.0j,
                        1.00000000e00 + 0.0j,
                        -8.30000000e-17 + 0.0j,
                        1.11000000e-16 + 0.0j,
                        1.00000000e00 + 0.0j,
                        -5.60000000e-17 + 0.0j,
                        1.11000000e-16 + 0.0j,
                        -1.61000000e-16 + 0.0j,
                        -1.03000000e-16 + 0.0j,
                        1.80000000e-16 + 0.0j,
                        1.00000000e00 + 0.0j,
                    ],
                ]
            ),
        ]

        for i, value_dict in enumerate(values_dict):
            result = metric_tensor.assign_parameters(value_dict).eval()
            np.testing.assert_array_almost_equal(result, correct_values[i])

    def test_calculate_imaginary(self):
        """Test calculating the imaginary part of a metric tensor."""
        observable = SummedOp(
            [
                0.2252 * (I ^ I),
                0.5716 * (Z ^ Z),
                0.3435 * (I ^ Z),
                -0.4347 * (Z ^ I),
                0.091 * (Y ^ Y),
                0.091 * (X ^ X),
            ]
        ).reduce()

        d = 2
        ansatz = EfficientSU2(observable.num_qubits, reps=d)

        # Define a set of initial parameters
        parameters = ansatz.ordered_parameters
        metric_tensor = calculate(ansatz, parameters, basis=-Y)

        values_dict = [
            {param: np.pi / 4 for param in parameters},
            {param: np.pi / 2 for param in parameters},
        ]
        # TODO extract
        correct_values = [
            array(
                [
                    [
                        -4.84000000e-34 + 0.0e00j,
                        4.84000000e-34 + 1.0e-18j,
                        7.07106781e-01 - 4.0e-18j,
                        -5.60000000e-17 + 0.0e00j,
                        -2.50000000e-01 + 0.0e00j,
                        3.53553391e-01 - 5.0e-18j,
                        6.76776695e-01 + 9.0e-18j,
                        3.53553391e-01 - 1.0e-18j,
                        -2.91053391e-01 + 0.0e00j,
                        3.90165043e-01 + 3.0e-18j,
                        5.93592168e-02 - 7.0e-18j,
                        -3.90165043e-01 + 1.5e-17j,
                    ],
                    [
                        4.84000000e-34 + 1.0e-18j,
                        -4.84000000e-34 + 0.0e00j,
                        4.40000000e-34 + 1.1e-17j,
                        7.07106781e-01 - 9.0e-18j,
                        -2.50000000e-01 + 0.0e00j,
                        -3.53553391e-01 + 1.6e-17j,
                        1.76776695e-01 - 5.0e-18j,
                        7.07106781e-01 - 1.0e-18j,
                        2.91053391e-01 - 3.0e-18j,
                        -3.90165043e-01 - 3.0e-18j,
                        4.41941738e-02 - 3.0e-18j,
                        1.09834957e-01 + 1.0e-18j,
                    ],
                    [
                        7.07106781e-01 - 4.0e-18j,
                        4.40000000e-34 + 1.1e-17j,
                        -5.00000000e-01 + 0.0e00j,
                        -5.00000000e-01 + 0.0e00j,
                        -4.26776695e-01 + 5.0e-18j,
                        -2.50000000e-01 + 7.0e-18j,
                        -4.05330086e-01 + 3.0e-18j,
                        1.87000000e-16 - 3.0e-18j,
                        7.00825215e-02 + 2.0e-18j,
                        -3.42830086e-01 - 4.0e-18j,
                        -6.53109217e-01 + 4.0e-18j,
                        -6.25000000e-02 + 0.0e00j,
                    ],
                    [
                        -5.60000000e-17 + 0.0e00j,
                        7.07106781e-01 - 9.0e-18j,
                        -5.00000000e-01 + 0.0e00j,
                        -5.00000000e-01 + 0.0e00j,
                        7.32233047e-02 - 6.0e-18j,
                        -6.03553391e-01 - 6.0e-18j,
                        -4.05330086e-01 + 1.0e-18j,
                        -3.53553391e-01 - 4.0e-18j,
                        -9.15291309e-02 - 4.0e-18j,
                        -4.67830086e-01 + 4.0e-18j,
                        -7.88832521e-01 + 0.0e00j,
                        -7.17830086e-01 + 5.0e-18j,
                    ],
                    [
                        -2.50000000e-01 + 0.0e00j,
                        -2.50000000e-01 + 0.0e00j,
                        -4.26776695e-01 + 5.0e-18j,
                        7.32233047e-02 - 6.0e-18j,
                        -6.25000000e-02 + 0.0e00j,
                        -8.83883476e-02 - 8.0e-18j,
                        5.95970869e-01 - 4.0e-18j,
                        1.04000000e-16 - 6.0e-18j,
                        -2.67845869e-01 - 2.0e-18j,
                        8.00206304e-01 + 2.0e-18j,
                        4.54560673e-01 + 5.0e-18j,
                        -1.93512130e-01 - 4.0e-18j,
                    ],
                    [
                        3.53553391e-01 - 5.0e-18j,
                        -3.53553391e-01 + 1.6e-17j,
                        -2.50000000e-01 + 7.0e-18j,
                        -6.03553391e-01 - 6.0e-18j,
                        -8.83883476e-02 - 8.0e-18j,
                        -1.25000000e-01 + 0.0e00j,
                        -1.14276695e-01 + 1.7e-17j,
                        7.07106781e-01 + 0.0e00j,
                        2.20970869e-02 + 4.0e-18j,
                        -5.17385912e-01 + 2.0e-18j,
                        -1.92401695e-01 + 1.7e-17j,
                        2.11167479e-01 + 1.0e-18j,
                    ],
                    [
                        6.76776695e-01 + 9.0e-18j,
                        1.76776695e-01 - 5.0e-18j,
                        -4.05330086e-01 + 3.0e-18j,
                        -4.05330086e-01 + 1.0e-18j,
                        5.95970869e-01 - 4.0e-18j,
                        -1.14276695e-01 + 1.7e-17j,
                        -1.04473305e-01 + 0.0e00j,
                        -2.75560000e-32 + 0.0e00j,
                        2.64839804e-01 - 4.0e-18j,
                        -1.16307044e-01 + 7.0e-18j,
                        -4.99770021e-01 + 0.0e00j,
                        -6.89720869e-02 + 1.0e-18j,
                    ],
                    [
                        3.53553391e-01 - 1.0e-18j,
                        7.07106781e-01 - 1.0e-18j,
                        1.87000000e-16 - 3.0e-18j,
                        -3.53553391e-01 - 4.0e-18j,
                        1.04000000e-16 - 6.0e-18j,
                        7.07106781e-01 + 0.0e00j,
                        -2.75560000e-32 + 0.0e00j,
                        -2.75560000e-32 + 0.0e00j,
                        7.17830086e-01 - 7.0e-18j,
                        -2.13388348e-01 + 8.0e-18j,
                        -3.82582521e-01 + 1.2e-17j,
                        -5.30330086e-01 + 1.0e-18j,
                    ],
                    [
                        -2.91053391e-01 + 0.0e00j,
                        2.91053391e-01 - 3.0e-18j,
                        7.00825215e-02 + 2.0e-18j,
                        -9.15291309e-02 - 4.0e-18j,
                        -2.67845869e-01 - 2.0e-18j,
                        2.20970869e-02 + 4.0e-18j,
                        2.64839804e-01 - 4.0e-18j,
                        7.17830086e-01 - 7.0e-18j,
                        -2.18864989e-01 + 0.0e00j,
                        -1.68341619e-01 + 1.6e-17j,
                        -3.10197821e-01 - 1.0e-17j,
                        -9.98294890e-02 + 3.0e-18j,
                    ],
                    [
                        3.90165043e-01 + 3.0e-18j,
                        -3.90165043e-01 - 3.0e-18j,
                        -3.42830086e-01 - 4.0e-18j,
                        -4.67830086e-01 + 4.0e-18j,
                        8.00206304e-01 + 2.0e-18j,
                        -5.17385912e-01 + 2.0e-18j,
                        -1.16307044e-01 + 7.0e-18j,
                        -2.13388348e-01 + 8.0e-18j,
                        -1.68341619e-01 + 1.6e-17j,
                        -1.29481196e-01 + 0.0e00j,
                        -1.88102847e-01 + 0.0e00j,
                        4.90157151e-01 - 9.0e-18j,
                    ],
                    [
                        5.93592168e-02 - 7.0e-18j,
                        4.41941738e-02 - 3.0e-18j,
                        -6.53109217e-01 + 4.0e-18j,
                        -7.88832521e-01 + 0.0e00j,
                        4.54560673e-01 + 5.0e-18j,
                        -1.92401695e-01 + 1.7e-17j,
                        -4.99770021e-01 + 0.0e00j,
                        -3.82582521e-01 + 1.2e-17j,
                        -3.10197821e-01 - 1.0e-17j,
                        -1.88102847e-01 + 0.0e00j,
                        -2.73265016e-01 + 0.0e00j,
                        -1.11548239e-01 + 0.0e00j,
                    ],
                    [
                        -3.90165043e-01 + 1.5e-17j,
                        1.09834957e-01 + 1.0e-18j,
                        -6.25000000e-02 + 0.0e00j,
                        -7.17830086e-01 + 5.0e-18j,
                        -1.93512130e-01 - 4.0e-18j,
                        2.11167479e-01 + 1.0e-18j,
                        -6.89720869e-02 + 1.0e-18j,
                        -5.30330086e-01 + 1.0e-18j,
                        -9.98294890e-02 + 3.0e-18j,
                        4.90157151e-01 - 9.0e-18j,
                        -1.11548239e-01 + 0.0e00j,
                        -4.55345869e-02 + 0.0e00j,
                    ],
                ]
            ),
            array(
                [
                    [
                        -4.8400e-34 + 0.0e00j,
                        3.0800e-34 + 0.0e00j,
                        1.0000e00 + 0.0e00j,
                        1.5400e-33 + 0.0e00j,
                        0.0000e00 + 0.0e00j,
                        1.0000e00 + 0.0e00j,
                        2.3600e-16 - 5.0e-18j,
                        -3.0800e-34 + 0.0e00j,
                        1.7600e-33 + 0.0e00j,
                        -2.0240e-33 + 0.0e00j,
                        0.0000e00 + 0.0e00j,
                        1.0000e00 + 0.0e00j,
                    ],
                    [
                        3.0800e-34 + 0.0e00j,
                        -1.9600e-34 + 0.0e00j,
                        -3.9200e-34 + 0.0e00j,
                        1.0000e00 + 0.0e00j,
                        0.0000e00 + 0.0e00j,
                        -1.6700e-16 + 0.0e00j,
                        -1.0000e-18 - 2.0e-18j,
                        1.9600e-34 + 0.0e00j,
                        -1.1200e-33 + 0.0e00j,
                        -1.3900e-16 + 0.0e00j,
                        1.1100e-16 + 0.0e00j,
                        0.0000e00 + 0.0e00j,
                    ],
                    [
                        1.0000e00 + 0.0e00j,
                        -3.9200e-34 + 0.0e00j,
                        -2.8340e-32 + 0.0e00j,
                        -1.5904e-32 + 0.0e00j,
                        -8.3000e-17 + 0.0e00j,
                        -2.3536e-32 + 0.0e00j,
                        -1.7700e-16 + 2.0e-18j,
                        -4.2560e-33 + 0.0e00j,
                        6.9000e-17 + 0.0e00j,
                        -5.5500e-16 + 0.0e00j,
                        3.6100e-16 + 0.0e00j,
                        0.0000e00 + 0.0e00j,
                    ],
                    [
                        1.5400e-33 + 0.0e00j,
                        1.0000e00 + 0.0e00j,
                        -1.5904e-32 + 0.0e00j,
                        -1.1956e-32 + 0.0e00j,
                        1.0000e00 + 0.0e00j,
                        -1.5148e-32 + 0.0e00j,
                        -1.3900e-16 - 2.0e-18j,
                        -1.0000e00 + 0.0e00j,
                        3.8900e-16 + 0.0e00j,
                        -8.4000e-17 + 0.0e00j,
                        -1.6296e-32 + 0.0e00j,
                        5.6000e-17 + 0.0e00j,
                    ],
                    [
                        0.0000e00 + 0.0e00j,
                        0.0000e00 + 0.0e00j,
                        -8.3000e-17 + 0.0e00j,
                        1.0000e00 + 0.0e00j,
                        0.0000e00 + 0.0e00j,
                        0.0000e00 + 0.0e00j,
                        2.5300e-16 + 1.1e-17j,
                        0.0000e00 + 0.0e00j,
                        0.0000e00 + 0.0e00j,
                        1.6700e-16 + 0.0e00j,
                        2.8000e-17 + 0.0e00j,
                        0.0000e00 + 0.0e00j,
                    ],
                    [
                        1.0000e00 + 0.0e00j,
                        -1.6700e-16 + 0.0e00j,
                        -2.3536e-32 + 0.0e00j,
                        -1.5148e-32 + 0.0e00j,
                        0.0000e00 + 0.0e00j,
                        -2.0788e-32 + 0.0e00j,
                        -1.4000e-17 + 0.0e00j,
                        -1.6700e-16 + 0.0e00j,
                        1.4600e-16 + 0.0e00j,
                        -3.8200e-16 + 0.0e00j,
                        8.3000e-17 + 0.0e00j,
                        0.0000e00 + 0.0e00j,
                    ],
                    [
                        2.3600e-16 - 5.0e-18j,
                        -1.0000e-18 - 2.0e-18j,
                        -1.7700e-16 + 2.0e-18j,
                        -1.3900e-16 - 2.0e-18j,
                        2.5300e-16 + 1.1e-17j,
                        -1.4000e-17 + 0.0e00j,
                        -7.8400e-34 + 0.0e00j,
                        -3.9200e-34 + 0.0e00j,
                        2.2400e-33 + 0.0e00j,
                        -1.1100e-16 + 0.0e00j,
                        1.0000e00 + 0.0e00j,
                        5.6000e-17 + 0.0e00j,
                    ],
                    [
                        -3.0800e-34 + 0.0e00j,
                        1.9600e-34 + 0.0e00j,
                        -4.2560e-33 + 0.0e00j,
                        -1.0000e00 + 0.0e00j,
                        0.0000e00 + 0.0e00j,
                        -1.6700e-16 + 0.0e00j,
                        -3.9200e-34 + 0.0e00j,
                        -9.8000e-34 + 0.0e00j,
                        2.8000e-17 + 0.0e00j,
                        -4.0300e-16 + 0.0e00j,
                        2.7800e-16 + 0.0e00j,
                        0.0000e00 + 0.0e00j,
                    ],
                    [
                        1.7600e-33 + 0.0e00j,
                        -1.1200e-33 + 0.0e00j,
                        6.9000e-17 + 0.0e00j,
                        3.8900e-16 + 0.0e00j,
                        0.0000e00 + 0.0e00j,
                        1.4600e-16 + 0.0e00j,
                        2.2400e-33 + 0.0e00j,
                        2.8000e-17 + 0.0e00j,
                        -1.0000e00 + 0.0e00j,
                        1.0000e00 + 0.0e00j,
                        1.9400e-16 + 0.0e00j,
                        0.0000e00 + 0.0e00j,
                    ],
                    [
                        -2.0240e-33 + 0.0e00j,
                        -1.3900e-16 + 0.0e00j,
                        -5.5500e-16 + 0.0e00j,
                        -8.4000e-17 + 0.0e00j,
                        1.6700e-16 + 0.0e00j,
                        -3.8200e-16 + 0.0e00j,
                        -1.1100e-16 + 0.0e00j,
                        -4.0300e-16 + 0.0e00j,
                        1.0000e00 + 0.0e00j,
                        -1.0000e00 + 0.0e00j,
                        -1.9400e-16 + 0.0e00j,
                        0.0000e00 + 0.0e00j,
                    ],
                    [
                        0.0000e00 + 0.0e00j,
                        1.1100e-16 + 0.0e00j,
                        3.6100e-16 + 0.0e00j,
                        -1.6296e-32 + 0.0e00j,
                        2.8000e-17 + 0.0e00j,
                        8.3000e-17 + 0.0e00j,
                        1.0000e00 + 0.0e00j,
                        2.7800e-16 + 0.0e00j,
                        1.9400e-16 + 0.0e00j,
                        -1.9400e-16 + 0.0e00j,
                        -3.7636e-32 + 0.0e00j,
                        0.0000e00 + 0.0e00j,
                    ],
                    [
                        1.0000e00 + 0.0e00j,
                        0.0000e00 + 0.0e00j,
                        0.0000e00 + 0.0e00j,
                        5.6000e-17 + 0.0e00j,
                        0.0000e00 + 0.0e00j,
                        0.0000e00 + 0.0e00j,
                        5.6000e-17 + 0.0e00j,
                        0.0000e00 + 0.0e00j,
                        0.0000e00 + 0.0e00j,
                        0.0000e00 + 0.0e00j,
                        0.0000e00 + 0.0e00j,
                        0.0000e00 + 0.0e00j,
                    ],
                ]
            ),
        ]
        # TODO verify correct values above
        for i, value_dict in enumerate(values_dict):
            result = metric_tensor.assign_parameters(value_dict).eval()
            np.testing.assert_array_almost_equal(result, correct_values[i])


if __name__ == "__main__":
    unittest.main()
