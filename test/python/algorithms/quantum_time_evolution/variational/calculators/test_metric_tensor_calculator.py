# This code is part of Qiskit.
#
# (C) Copyright IBM 2021.
#
# This code is licensed under the Apache License, Version 2.0. You may
# obtain a copy of this license in the LICENSE.txt file in the root directory
# of this source tree or at http://www.apache.org/licenses/LICENSE-2.0.
#
# Any modifications or derivative works of this code must retain this
# copyright notice, and modified files need to carry a notice indicating
# that they have been altered from the originals.

"""Test metric tensor calculator."""

import unittest
from test.python.algorithms import QiskitAlgorithmsTestCase
import numpy as np
from numpy import array

from qiskit.algorithms.quantum_time_evolution.variational.calculators.metric_tensor_calculator import (
    calculate,
)
from qiskit.circuit.library import EfficientSU2
from qiskit.opflow import SummedOp, X, Y, I, Z


class TestMetricTensorCalculator(QiskitAlgorithmsTestCase):
    """Test metric tensor calculator."""

    # checked, correct
    def test_calculate_real(self):
        """Test calculating the real part of a metric tensor."""
        observable = SummedOp(
            [
                0.2252 * (I ^ I),
                0.5716 * (Z ^ Z),
                0.3435 * (I ^ Z),
                -0.4347 * (Z ^ I),
                0.091 * (Y ^ Y),
                0.091 * (X ^ X),
            ]
        ).reduce()

        d = 2
        ansatz = EfficientSU2(observable.num_qubits, reps=d)

        # Define a set of initial parameters
        parameters = ansatz.ordered_parameters
        metric_tensor = calculate(ansatz, parameters)

        values_dict = [
            {param: np.pi / 4 for param in parameters},
            {param: np.pi / 2 for param in parameters},
        ]
        # TODO extract
        correct_values = [
            array(
                [
                    [
                        1.00000000e00 + 0.0j,
                        0.00000000e00 + 0.0j,
                        8.30000000e-17 + 0.0j,
                        5.60000000e-17 + 0.0j,
                        3.53553391e-01 + 0.0j,
                        8.30000000e-17 + 0.0j,
                        2.50000000e-01 + 0.0j,
                        5.60000000e-17 + 0.0j,
                        -5.66941738e-01 + 0.0j,
                        1.25000000e-01 + 0.0j,
                        4.00888348e-01 + 0.0j,
                        -1.25000000e-01 + 0.0j,
                    ],
                    [
                        0.00000000e00 + 0.0j,
                        1.00000000e00 + 0.0j,
                        0.00000000e00 + 0.0j,
                        -2.80000000e-17 + 0.0j,
                        -3.53553391e-01 + 0.0j,
                        5.00000000e-01 + 0.0j,
                        2.50000000e-01 + 0.0j,
                        5.00000000e-01 + 0.0j,
                        -3.38388348e-01 + 0.0j,
                        3.01776695e-01 + 0.0j,
                        5.92830086e-01 + 0.0j,
                        8.01776695e-01 + 0.0j,
                    ],
                    [
                        8.30000000e-17 + 0.0j,
                        0.00000000e00 + 0.0j,
                        5.00000000e-01 + 0.0j,
                        -5.55111512e-17 + 0.0j,
                        -1.76776695e-01 + 0.0j,
                        2.50000000e-01 + 0.0j,
                        4.78553391e-01 + 0.0j,
                        2.50000000e-01 + 0.0j,
                        -2.05805826e-01 + 0.0j,
                        2.75888348e-01 + 0.0j,
                        4.19733047e-02 + 0.0j,
                        -2.75888348e-01 + 0.0j,
                    ],
                    [
                        5.60000000e-17 + 0.0j,
                        -2.80000000e-17 + 0.0j,
                        -5.55111512e-17 + 0.0j,
                        5.00000000e-01 + 0.0j,
                        -1.76776695e-01 + 0.0j,
                        -2.50000000e-01 + 0.0j,
                        1.25000000e-01 + 0.0j,
                        5.00000000e-01 + 0.0j,
                        2.05805826e-01 + 0.0j,
                        -2.75888348e-01 + 0.0j,
                        3.12500000e-02 + 0.0j,
                        7.76650429e-02 + 0.0j,
                    ],
                    [
                        3.53553391e-01 + 0.0j,
                        -3.53553391e-01 + 0.0j,
                        -1.76776695e-01 + 0.0j,
                        -1.76776695e-01 + 0.0j,
                        9.37500000e-01 + 0.0j,
                        -4.41941738e-01 + 0.0j,
                        -8.08058262e-02 + 0.0j,
                        -1.76776695e-01 + 0.0j,
                        5.98191738e-02 + 0.0j,
                        -8.99587393e-02 + 0.0j,
                        -5.68689110e-03 + 0.0j,
                        -4.95288825e-01 + 0.0j,
                    ],
                    [
                        8.30000000e-17 + 0.0j,
                        5.00000000e-01 + 0.0j,
                        2.50000000e-01 + 0.0j,
                        -2.50000000e-01 + 0.0j,
                        -4.41941738e-01 + 0.0j,
                        8.75000000e-01 + 0.0j,
                        -1.07233047e-02 + 0.0j,
                        -3.95979797e-17 + 0.0j,
                        -6.28791261e-01 + 0.0j,
                        1.01332521e-01 + 0.0j,
                        3.92924785e-02 + 0.0j,
                        4.24555826e-01 + 0.0j,
                    ],
                    [
                        2.50000000e-01 + 0.0j,
                        2.50000000e-01 + 0.0j,
                        4.78553391e-01 + 0.0j,
                        1.25000000e-01 + 0.0j,
                        -8.08058262e-02 + 0.0j,
                        -1.07233047e-02 + 0.0j,
                        8.95526695e-01 + 0.0j,
                        5.51776695e-01 + 0.0j,
                        -1.51213586e-01 + 0.0j,
                        6.33692956e-01 + 0.0j,
                        5.38142586e-01 + 0.0j,
                        -2.19860435e-01 + 0.0j,
                    ],
                    [
                        5.60000000e-17 + 0.0j,
                        5.00000000e-01 + 0.0j,
                        2.50000000e-01 + 0.0j,
                        5.00000000e-01 + 0.0j,
                        -1.76776695e-01 + 0.0j,
                        -3.95979797e-17 + 0.0j,
                        5.51776695e-01 + 0.0j,
                        1.00000000e00 + 0.0j,
                        -5.23969696e-17 + 0.0j,
                        7.06984848e-17 + 0.0j,
                        3.90165043e-01 + 0.0j,
                        2.28553391e-01 + 0.0j,
                    ],
                    [
                        -5.66941738e-01 + 0.0j,
                        -3.38388348e-01 + 0.0j,
                        -2.05805826e-01 + 0.0j,
                        2.05805826e-01 + 0.0j,
                        5.98191738e-02 + 0.0j,
                        -6.28791261e-01 + 0.0j,
                        -1.51213586e-01 + 0.0j,
                        -5.23969696e-17 + 0.0j,
                        7.81135011e-01 + 0.0j,
                        -1.53176576e-01 + 0.0j,
                        -2.44557038e-01 + 0.0j,
                        -1.80635315e-01 + 0.0j,
                    ],
                    [
                        1.25000000e-01 + 0.0j,
                        3.01776695e-01 + 0.0j,
                        2.75888348e-01 + 0.0j,
                        -2.75888348e-01 + 0.0j,
                        -8.99587393e-02 + 0.0j,
                        1.01332521e-01 + 0.0j,
                        6.33692956e-01 + 0.0j,
                        7.06984848e-17 + 0.0j,
                        -1.53176576e-01 + 0.0j,
                        8.70518804e-01 + 0.0j,
                        5.29727238e-01 + 0.0j,
                        -7.67845869e-02 + 0.0j,
                    ],
                    [
                        4.00888348e-01 + 0.0j,
                        5.92830086e-01 + 0.0j,
                        4.19733047e-02 + 0.0j,
                        3.12500000e-02 + 0.0j,
                        -5.68689110e-03 + 0.0j,
                        3.92924785e-02 + 0.0j,
                        5.38142586e-01 + 0.0j,
                        3.90165043e-01 + 0.0j,
                        -2.44557038e-01 + 0.0j,
                        5.29727238e-01 + 0.0j,
                        7.26734984e-01 + 0.0j,
                        2.91560978e-01 + 0.0j,
                    ],
                    [
                        -1.25000000e-01 + 0.0j,
                        8.01776695e-01 + 0.0j,
                        -2.75888348e-01 + 0.0j,
                        7.76650429e-02 + 0.0j,
                        -4.95288825e-01 + 0.0j,
                        4.24555826e-01 + 0.0j,
                        -2.19860435e-01 + 0.0j,
                        2.28553391e-01 + 0.0j,
                        -1.80635315e-01 + 0.0j,
                        -7.67845869e-02 + 0.0j,
                        2.91560978e-01 + 0.0j,
                        9.54465413e-01 + 0.0j,
                    ],
                ]
            ),
            array(
                [
                    [
                        1.00000000e00 + 0.0j,
                        0.00000000e00 + 0.0j,
                        1.67000000e-16 + 0.0j,
                        0.00000000e00 + 0.0j,
                        0.00000000e00 + 0.0j,
                        5.60000000e-17 + 0.0j,
                        1.67000000e-16 + 0.0j,
                        -5.60000000e-17 + 0.0j,
                        0.00000000e00 + 0.0j,
                        3.33000000e-16 + 0.0j,
                        -1.67000000e-16 + 0.0j,
                        -2.80000000e-17 + 0.0j,
                    ],
                    [
                        0.00000000e00 + 0.0j,
                        1.00000000e00 + 0.0j,
                        0.00000000e00 + 0.0j,
                        2.50000000e-16 + 0.0j,
                        -1.00000000e00 + 0.0j,
                        -5.60000000e-17 + 0.0j,
                        8.30000000e-17 + 0.0j,
                        1.00000000e00 + 0.0j,
                        -5.60000000e-17 + 0.0j,
                        4.20000000e-17 + 0.0j,
                        -2.80000000e-17 + 0.0j,
                        2.80000000e-17 + 0.0j,
                    ],
                    [
                        1.67000000e-16 + 0.0j,
                        0.00000000e00 + 0.0j,
                        1.00000000e00 + 0.0j,
                        -1.24320000e-32 + 0.0j,
                        2.80000000e-17 + 0.0j,
                        1.00000000e00 + 0.0j,
                        8.30000000e-17 + 0.0j,
                        2.80000000e-17 + 0.0j,
                        2.80000000e-17 + 0.0j,
                        -3.05000000e-16 + 0.0j,
                        1.11000000e-16 + 0.0j,
                        1.00000000e00 + 0.0j,
                    ],
                    [
                        0.00000000e00 + 0.0j,
                        2.50000000e-16 + 0.0j,
                        -1.24320000e-32 + 0.0j,
                        1.00000000e00 + 0.0j,
                        1.11000000e-16 + 0.0j,
                        1.67000000e-16 + 0.0j,
                        2.50000000e-16 + 0.0j,
                        2.78000000e-16 + 0.0j,
                        4.20000000e-17 + 0.0j,
                        -1.67000000e-16 + 0.0j,
                        1.53000000e-16 + 0.0j,
                        -8.30000000e-17 + 0.0j,
                    ],
                    [
                        0.00000000e00 + 0.0j,
                        -1.00000000e00 + 0.0j,
                        2.80000000e-17 + 0.0j,
                        1.11000000e-16 + 0.0j,
                        1.00000000e00 + 0.0j,
                        1.11000000e-16 + 0.0j,
                        -1.94000000e-16 + 0.0j,
                        -1.00000000e00 + 0.0j,
                        5.60000000e-17 + 0.0j,
                        -5.60000000e-17 + 0.0j,
                        -1.11000000e-16 + 0.0j,
                        1.11000000e-16 + 0.0j,
                    ],
                    [
                        5.60000000e-17 + 0.0j,
                        -5.60000000e-17 + 0.0j,
                        1.00000000e00 + 0.0j,
                        1.67000000e-16 + 0.0j,
                        1.11000000e-16 + 0.0j,
                        1.00000000e00 + 0.0j,
                        -4.20000000e-17 + 0.0j,
                        2.40840000e-32 + 0.0j,
                        -1.00000000e-18 + 0.0j,
                        -1.94000000e-16 + 0.0j,
                        5.60000000e-17 + 0.0j,
                        1.00000000e00 + 0.0j,
                    ],
                    [
                        1.67000000e-16 + 0.0j,
                        8.30000000e-17 + 0.0j,
                        8.30000000e-17 + 0.0j,
                        2.50000000e-16 + 0.0j,
                        -1.94000000e-16 + 0.0j,
                        -4.20000000e-17 + 0.0j,
                        1.00000000e00 + 0.0j,
                        1.94000000e-16 + 0.0j,
                        -5.60000000e-17 + 0.0j,
                        1.25000000e-16 + 0.0j,
                        2.08000000e-16 + 0.0j,
                        -5.60000000e-17 + 0.0j,
                    ],
                    [
                        -5.60000000e-17 + 0.0j,
                        1.00000000e00 + 0.0j,
                        2.80000000e-17 + 0.0j,
                        2.78000000e-16 + 0.0j,
                        -1.00000000e00 + 0.0j,
                        2.40840000e-32 + 0.0j,
                        1.94000000e-16 + 0.0j,
                        1.00000000e00 + 0.0j,
                        -9.60000000e-17 + 0.0j,
                        8.30000000e-17 + 0.0j,
                        1.39000000e-16 + 0.0j,
                        1.11000000e-16 + 0.0j,
                    ],
                    [
                        0.00000000e00 + 0.0j,
                        -5.60000000e-17 + 0.0j,
                        2.80000000e-17 + 0.0j,
                        4.20000000e-17 + 0.0j,
                        5.60000000e-17 + 0.0j,
                        -1.00000000e-18 + 0.0j,
                        -5.60000000e-17 + 0.0j,
                        -9.60000000e-17 + 0.0j,
                        1.11022302e-16 + 0.0j,
                        -5.55111512e-16 + 0.0j,
                        1.10000000e-16 + 0.0j,
                        -1.61000000e-16 + 0.0j,
                    ],
                    [
                        3.33000000e-16 + 0.0j,
                        4.20000000e-17 + 0.0j,
                        -3.05000000e-16 + 0.0j,
                        -1.67000000e-16 + 0.0j,
                        -5.60000000e-17 + 0.0j,
                        -1.94000000e-16 + 0.0j,
                        1.25000000e-16 + 0.0j,
                        8.30000000e-17 + 0.0j,
                        -5.55111512e-16 + 0.0j,
                        4.44089210e-16 + 0.0j,
                        -1.10000000e-16 + 0.0j,
                        -1.03000000e-16 + 0.0j,
                    ],
                    [
                        -1.67000000e-16 + 0.0j,
                        -2.80000000e-17 + 0.0j,
                        1.11000000e-16 + 0.0j,
                        1.53000000e-16 + 0.0j,
                        -1.11000000e-16 + 0.0j,
                        5.60000000e-17 + 0.0j,
                        2.08000000e-16 + 0.0j,
                        1.39000000e-16 + 0.0j,
                        1.10000000e-16 + 0.0j,
                        -1.10000000e-16 + 0.0j,
                        1.00000000e00 + 0.0j,
                        1.80000000e-16 + 0.0j,
                    ],
                    [
                        -2.80000000e-17 + 0.0j,
                        2.80000000e-17 + 0.0j,
                        1.00000000e00 + 0.0j,
                        -8.30000000e-17 + 0.0j,
                        1.11000000e-16 + 0.0j,
                        1.00000000e00 + 0.0j,
                        -5.60000000e-17 + 0.0j,
                        1.11000000e-16 + 0.0j,
                        -1.61000000e-16 + 0.0j,
                        -1.03000000e-16 + 0.0j,
                        1.80000000e-16 + 0.0j,
                        1.00000000e00 + 0.0j,
                    ],
                ]
            ),
        ]

        for i, value_dict in enumerate(values_dict):
            result = metric_tensor.assign_parameters(value_dict).eval()
            np.testing.assert_array_almost_equal(result, correct_values[i])

    def test_calculate_imaginary(self):
        """Test calculating the imaginary part of a metric tensor."""
        observable = SummedOp(
            [
                0.2252 * (I ^ I),
                0.5716 * (Z ^ Z),
                0.3435 * (I ^ Z),
                -0.4347 * (Z ^ I),
                0.091 * (Y ^ Y),
                0.091 * (X ^ X),
            ]
        ).reduce()

        d = 2
        ansatz = EfficientSU2(observable.num_qubits, reps=d)

        # Define a set of initial parameters
        parameters = ansatz.ordered_parameters
        metric_tensor = calculate(ansatz, parameters, basis=-1j * Y)

        values_dict = [
            {param: np.pi / 4 for param in parameters},
            {param: np.pi / 2 for param in parameters},
        ]
        # TODO extract
        correct_values = [
            array(
                [
                    [
                        0.00000000e00 + 0.00000000e00j,
                        0.00000000e00 + 0.00000000e00j,
                        0.00000000e00 + 7.07106781e-01j,
                        0.00000000e00 - 5.60000000e-17j,
                        0.00000000e00 - 2.50000000e-01j,
                        0.00000000e00 + 3.53553391e-01j,
                        0.00000000e00 + 6.76776695e-01j,
                        0.00000000e00 + 3.53553391e-01j,
                        0.00000000e00 - 2.91053391e-01j,
                        0.00000000e00 + 3.90165043e-01j,
                        0.00000000e00 + 5.93592168e-02j,
                        0.00000000e00 - 3.90165043e-01j,
                    ],
                    [
                        0.00000000e00 + 0.00000000e00j,
                        0.00000000e00 + 0.00000000e00j,
                        0.00000000e00 + 0.00000000e00j,
                        0.00000000e00 + 7.07106781e-01j,
                        0.00000000e00 - 2.50000000e-01j,
                        0.00000000e00 - 3.53553391e-01j,
                        0.00000000e00 + 1.76776695e-01j,
                        0.00000000e00 + 7.07106781e-01j,
                        0.00000000e00 + 2.91053391e-01j,
                        0.00000000e00 - 3.90165043e-01j,
                        0.00000000e00 + 4.41941738e-02j,
                        0.00000000e00 + 1.09834957e-01j,
                    ],
                    [
                        0.00000000e00 + 7.07106781e-01j,
                        0.00000000e00 + 0.00000000e00j,
                        -5.00000000e-01 + 0.00000000e00j,
                        -5.00000000e-01 + 0.00000000e00j,
                        -1.76776695e-01 - 2.50000000e-01j,
                        -2.50000000e-01 + 2.80000000e-17j,
                        -2.28553391e-01 - 1.76776695e-01j,
                        -7.91959595e-17 + 1.67000000e-16j,
                        -3.30805826e-01 + 4.00888348e-01j,
                        -2.54441738e-01 - 8.83883476e-02j,
                        -3.69638348e-01 - 2.83470869e-01j,
                        -1.50888348e-01 + 8.83883476e-02j,
                    ],
                    [
                        0.00000000e00 - 5.60000000e-17j,
                        0.00000000e00 + 7.07106781e-01j,
                        -5.00000000e-01 + 0.00000000e00j,
                        -5.00000000e-01 + 0.00000000e00j,
                        -1.76776695e-01 + 2.50000000e-01j,
                        -2.50000000e-01 - 3.53553391e-01j,
                        -2.28553391e-01 - 1.76776695e-01j,
                        -7.91959595e-17 - 3.53553391e-01j,
                        -3.30805826e-01 + 2.39276695e-01j,
                        -2.54441738e-01 - 2.13388348e-01j,
                        -3.69638348e-01 - 4.19194174e-01j,
                        -1.50888348e-01 - 5.66941738e-01j,
                    ],
                    [
                        0.00000000e00 - 2.50000000e-01j,
                        0.00000000e00 - 2.50000000e-01j,
                        -1.76776695e-01 - 2.50000000e-01j,
                        -1.76776695e-01 + 2.50000000e-01j,
                        -6.25000000e-02 + 0.00000000e00j,
                        -8.83883476e-02 + 5.60000000e-17j,
                        -8.08058262e-02 + 6.76776695e-01j,
                        -2.80000000e-17 + 8.30000000e-17j,
                        -1.16957521e-01 - 1.50888348e-01j,
                        -8.99587393e-02 + 8.90165043e-01j,
                        -1.30686891e-01 + 5.85247564e-01j,
                        -5.33470869e-02 - 1.40165043e-01j,
                    ],
                    [
                        0.00000000e00 + 3.53553391e-01j,
                        0.00000000e00 - 3.53553391e-01j,
                        -2.50000000e-01 + 2.80000000e-17j,
                        -2.50000000e-01 - 3.53553391e-01j,
                        -8.83883476e-02 + 5.60000000e-17j,
                        -1.25000000e-01 + 0.00000000e00j,
                        -1.14276695e-01 + 5.60000000e-17j,
                        -3.95979797e-17 + 7.07106781e-01j,
                        -1.65402913e-01 + 1.87500000e-01j,
                        -1.27220869e-01 - 3.90165043e-01j,
                        -1.84819174e-01 - 7.58252147e-03j,
                        -7.54441738e-02 + 2.86611652e-01j,
                    ],
                    [
                        0.00000000e00 + 6.76776695e-01j,
                        0.00000000e00 + 1.76776695e-01j,
                        -2.28553391e-01 - 1.76776695e-01j,
                        -2.28553391e-01 - 1.76776695e-01j,
                        -8.08058262e-02 + 6.76776695e-01j,
                        -1.14276695e-01 + 5.60000000e-17j,
                        -1.04473305e-01 + 0.00000000e00j,
                        -3.62010101e-17 + 0.00000000e00j,
                        -1.51213586e-01 + 4.16053391e-01j,
                        -1.16307044e-01 + 6.90000000e-17j,
                        -1.68964195e-01 - 3.30805826e-01j,
                        -6.89720869e-02 - 6.20000000e-17j,
                    ],
                    [
                        0.00000000e00 + 3.53553391e-01j,
                        0.00000000e00 + 7.07106781e-01j,
                        -7.91959595e-17 + 1.67000000e-16j,
                        -7.91959595e-17 - 3.53553391e-01j,
                        -2.80000000e-17 + 8.30000000e-17j,
                        -3.95979797e-17 + 7.07106781e-01j,
                        -3.62010101e-17 + 0.00000000e00j,
                        -2.50880000e-32 + 0.00000000e00j,
                        -5.23969696e-17 + 7.17830086e-01j,
                        -4.03015152e-17 - 2.13388348e-01j,
                        -5.85477272e-17 - 3.82582521e-01j,
                        -2.38994949e-17 - 5.30330086e-01j,
                    ],
                    [
                        0.00000000e00 - 2.91053391e-01j,
                        0.00000000e00 + 2.91053391e-01j,
                        -3.30805826e-01 + 4.00888348e-01j,
                        -3.30805826e-01 + 2.39276695e-01j,
                        -1.16957521e-01 - 1.50888348e-01j,
                        -1.65402913e-01 + 1.87500000e-01j,
                        -1.51213586e-01 + 4.16053391e-01j,
                        -5.23969696e-17 + 7.17830086e-01j,
                        -2.18864989e-01 + 0.00000000e00j,
                        -1.68341619e-01 - 1.11000000e-16j,
                        -2.44557038e-01 - 6.56407832e-02j,
                        -9.98294890e-02 - 1.11000000e-16j,
                    ],
                    [
                        0.00000000e00 + 3.90165043e-01j,
                        0.00000000e00 - 3.90165043e-01j,
                        -2.54441738e-01 - 8.83883476e-02j,
                        -2.54441738e-01 - 2.13388348e-01j,
                        -8.99587393e-02 + 8.90165043e-01j,
                        -1.27220869e-01 - 3.90165043e-01j,
                        -1.16307044e-01 + 6.90000000e-17j,
                        -4.03015152e-17 - 2.13388348e-01j,
                        -1.68341619e-01 - 1.11000000e-16j,
                        -1.29481196e-01 + 0.00000000e00j,
                        -1.88102847e-01 - 4.20000000e-17j,
                        -7.67845869e-02 + 5.66941738e-01j,
                    ],
                    [
                        0.00000000e00 + 5.93592168e-02j,
                        0.00000000e00 + 4.41941738e-02j,
                        -3.69638348e-01 - 2.83470869e-01j,
                        -3.69638348e-01 - 4.19194174e-01j,
                        -1.30686891e-01 + 5.85247564e-01j,
                        -1.84819174e-01 - 7.58252147e-03j,
                        -1.68964195e-01 - 3.30805826e-01j,
                        -5.85477272e-17 - 3.82582521e-01j,
                        -2.44557038e-01 - 6.56407832e-02j,
                        -1.88102847e-01 - 4.20000000e-17j,
                        -2.73265016e-01 + 0.00000000e00j,
                        -1.11548239e-01 + 0.00000000e00j,
                    ],
                    [
                        0.00000000e00 - 3.90165043e-01j,
                        0.00000000e00 + 1.09834957e-01j,
                        -1.50888348e-01 + 8.83883476e-02j,
                        -1.50888348e-01 - 5.66941738e-01j,
                        -5.33470869e-02 - 1.40165043e-01j,
                        -7.54441738e-02 + 2.86611652e-01j,
                        -6.89720869e-02 - 6.20000000e-17j,
                        -2.38994949e-17 - 5.30330086e-01j,
                        -9.98294890e-02 - 1.11000000e-16j,
                        -7.67845869e-02 + 5.66941738e-01j,
                        -1.11548239e-01 + 0.00000000e00j,
                        -4.55345869e-02 + 0.00000000e00j,
                    ],
                ]
            ),
            array(
                [
                    [
                        0.0000e00 + 0.00e00j,
                        0.0000e00 + 0.00e00j,
                        0.0000e00 + 1.00e00j,
                        0.0000e00 + 0.00e00j,
                        0.0000e00 + 0.00e00j,
                        0.0000e00 + 1.00e00j,
                        0.0000e00 + 2.36e-16j,
                        0.0000e00 + 0.00e00j,
                        0.0000e00 + 0.00e00j,
                        0.0000e00 + 0.00e00j,
                        0.0000e00 + 0.00e00j,
                        0.0000e00 + 1.00e00j,
                    ],
                    [
                        0.0000e00 + 0.00e00j,
                        0.0000e00 + 0.00e00j,
                        0.0000e00 + 0.00e00j,
                        0.0000e00 + 1.00e00j,
                        0.0000e00 + 0.00e00j,
                        0.0000e00 - 1.67e-16j,
                        0.0000e00 - 1.00e-18j,
                        0.0000e00 + 0.00e00j,
                        0.0000e00 + 0.00e00j,
                        0.0000e00 - 1.53e-16j,
                        0.0000e00 + 1.11e-16j,
                        0.0000e00 + 0.00e00j,
                    ],
                    [
                        0.0000e00 + 1.00e00j,
                        0.0000e00 + 0.00e00j,
                        -4.9284e-32 + 0.00e00j,
                        -1.2432e-32 + 0.00e00j,
                        0.0000e00 - 8.30e-17j,
                        -3.3744e-32 + 0.00e00j,
                        1.2432e-32 - 1.77e-16j,
                        3.3744e-32 + 0.00e00j,
                        2.2200e-16 - 1.11e-16j,
                        -2.2200e-16 - 4.16e-16j,
                        -3.6852e-32 + 3.61e-16j,
                        -1.3320e-33 + 0.00e00j,
                    ],
                    [
                        0.0000e00 + 0.00e00j,
                        0.0000e00 + 1.00e00j,
                        -1.2432e-32 + 0.00e00j,
                        -3.1360e-33 + 0.00e00j,
                        0.0000e00 + 1.00e00j,
                        -8.5120e-33 + 0.00e00j,
                        3.1360e-33 - 1.39e-16j,
                        8.5120e-33 - 1.00e00j,
                        5.6000e-17 + 3.19e-16j,
                        -5.6000e-17 + 0.00e00j,
                        -9.2960e-33 + 0.00e00j,
                        -3.3600e-34 + 5.60e-17j,
                    ],
                    [
                        0.0000e00 + 0.00e00j,
                        0.0000e00 + 0.00e00j,
                        0.0000e00 - 8.30e-17j,
                        0.0000e00 + 1.00e00j,
                        0.0000e00 + 0.00e00j,
                        0.0000e00 + 0.00e00j,
                        0.0000e00 + 2.53e-16j,
                        0.0000e00 + 0.00e00j,
                        0.0000e00 + 0.00e00j,
                        0.0000e00 + 1.67e-16j,
                        0.0000e00 + 2.80e-17j,
                        0.0000e00 + 0.00e00j,
                    ],
                    [
                        0.0000e00 + 1.00e00j,
                        0.0000e00 - 1.67e-16j,
                        -3.3744e-32 + 0.00e00j,
                        -8.5120e-33 + 0.00e00j,
                        0.0000e00 + 0.00e00j,
                        -2.8004e-32 + 0.00e00j,
                        1.0472e-32 + 0.00e00j,
                        2.4084e-32 - 1.67e-16j,
                        1.5200e-16 + 1.40e-17j,
                        -1.5200e-16 - 2.36e-16j,
                        -2.3272e-32 + 8.30e-17j,
                        -9.1200e-34 + 0.00e00j,
                    ],
                    [
                        0.0000e00 + 2.36e-16j,
                        0.0000e00 - 1.00e-18j,
                        1.2432e-32 - 1.77e-16j,
                        3.1360e-33 - 1.39e-16j,
                        0.0000e00 + 2.53e-16j,
                        1.0472e-32 + 0.00e00j,
                        -3.9200e-33 + 0.00e00j,
                        -8.9040e-33 + 0.00e00j,
                        -5.6000e-17 + 0.00e00j,
                        5.6000e-17 - 1.11e-16j,
                        8.5120e-33 + 1.00e00j,
                        3.3600e-34 + 5.60e-17j,
                    ],
                    [
                        0.0000e00 + 0.00e00j,
                        0.0000e00 + 0.00e00j,
                        3.3744e-32 + 0.00e00j,
                        8.5120e-33 - 1.00e00j,
                        0.0000e00 + 0.00e00j,
                        2.4084e-32 - 1.67e-16j,
                        -8.9040e-33 + 0.00e00j,
                        -2.3300e-32 + 0.00e00j,
                        -1.5200e-16 + 0.00e00j,
                        1.5200e-16 - 4.02e-16j,
                        2.4840e-32 + 2.78e-16j,
                        9.1200e-34 + 0.00e00j,
                    ],
                    [
                        0.0000e00 + 0.00e00j,
                        0.0000e00 + 0.00e00j,
                        2.2200e-16 - 1.11e-16j,
                        5.6000e-17 + 3.19e-16j,
                        0.0000e00 + 0.00e00j,
                        1.5200e-16 + 1.40e-17j,
                        -5.6000e-17 + 0.00e00j,
                        -1.5200e-16 + 0.00e00j,
                        -1.0000e00 + 0.00e00j,
                        1.0000e00 + 0.00e00j,
                        1.6600e-16 + 0.00e00j,
                        6.0000e-18 + 0.00e00j,
                    ],
                    [
                        0.0000e00 + 0.00e00j,
                        0.0000e00 - 1.53e-16j,
                        -2.2200e-16 - 4.16e-16j,
                        -5.6000e-17 + 0.00e00j,
                        0.0000e00 + 1.67e-16j,
                        -1.5200e-16 - 2.36e-16j,
                        5.6000e-17 - 1.11e-16j,
                        1.5200e-16 - 4.02e-16j,
                        1.0000e00 + 0.00e00j,
                        -1.0000e00 + 0.00e00j,
                        -1.6600e-16 + 0.00e00j,
                        -6.0000e-18 + 0.00e00j,
                    ],
                    [
                        0.0000e00 + 0.00e00j,
                        0.0000e00 + 1.11e-16j,
                        -3.6852e-32 + 3.61e-16j,
                        -9.2960e-33 + 0.00e00j,
                        0.0000e00 + 2.80e-17j,
                        -2.3272e-32 + 8.30e-17j,
                        8.5120e-33 + 1.00e00j,
                        2.4840e-32 + 2.78e-16j,
                        1.6600e-16 + 0.00e00j,
                        -1.6600e-16 + 0.00e00j,
                        -2.8340e-32 + 0.00e00j,
                        -9.9600e-34 + 0.00e00j,
                    ],
                    [
                        0.0000e00 + 1.00e00j,
                        0.0000e00 + 0.00e00j,
                        -1.3320e-33 + 0.00e00j,
                        -3.3600e-34 + 5.60e-17j,
                        0.0000e00 + 0.00e00j,
                        -9.1200e-34 + 0.00e00j,
                        3.3600e-34 + 5.60e-17j,
                        9.1200e-34 + 0.00e00j,
                        6.0000e-18 + 0.00e00j,
                        -6.0000e-18 + 0.00e00j,
                        -9.9600e-34 + 0.00e00j,
                        -3.6000e-35 + 0.00e00j,
                    ],
                ]
            ),
        ]
        # TODO verify correct values above
        for i, value_dict in enumerate(values_dict):
            result = metric_tensor.assign_parameters(value_dict).eval()

            np.testing.assert_array_almost_equal(result, correct_values[i])


if __name__ == "__main__":
    unittest.main()
